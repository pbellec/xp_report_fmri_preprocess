<!DOCTYPE html>
<html>

<style>


.slider-Wrapper
{
    position:absolute;
    z-index:20;
    top:15px;
    margin-left:0%;
    width:1px;
}

a.slider-Prev, a.slider-Next
{
    width:50px;height:150px;
    background:transparent url(assets/jsImageSlider/navbuttons2.gif); 
    display:block; 
    cursor:pointer;
    position:absolute;
    top:0;
    user-select: none;
}
a.slider-Prev{background-position:0 0; left:0px;}
a.slider-Next{background-position:0 -150px; left:50px;}

a.slider-Prev:hover{background-position:50px 0;}
a.slider-Next:hover{background-position:50px -150px;}

.register img{
    -webkit-transition: opacity 0.75s; /* Safari */
    transition: opacity 0.75s;
}

.register img:hover{
    opacity:0;
}

</style>

<head>
  <title>Report on the quality of MRI registration</title>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <link rel="stylesheet" type="text/css" href="assets/bootstrap/bootstrap.min.css" /> <!--from keen.io-->
  <link rel="stylesheet" type="text/css" href="assets/keen/keen-dashboards.css" />    <!--from keen.io-->
  <link rel="stylesheet" type="text/css" href="assets/pretty-json/pretty-json.css" /> <!--from pretty-json-->
  <link href="assets/select2/select2.min.css" rel="stylesheet" /> <!--from select 2-->
  <link href="assets/c3js/c3.min.css" rel="stylesheet" type="text/css"> <!--from c3.js-->
</head>

<body class="application">

  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://niak.simexp-lab.org/pipe_preprocessing.html">fMRI preprocessing pipeline</a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-left">
          <li><a href="summary.html">Summary</a></li>
          <li><a href="registration.html">Registration</a></li>
          <li><a href="motion.html">Motion</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container-fluid">

    <div class="row">
    
      <div class="col-sm-6">
        <div class="chart-wrapper">
          <div class="chart-title">
            Summary T1 registration
          </div>
          <div class="chart-stage">
              <div id="chart-T1" style="width:95%"></div>
          </div>
          <div class="chart-notes">
            Click on a bar to select a subject. Mouse scroll to zoom.
          </div>
        </div>
      </div>
      
      <div class="col-sm-6">
        <div class="chart-wrapper">
          <div class="chart-title">
            Summary BOLD registration
          </div>
          <div class="chart-stage">
              <div id="chart-BOLD" style="width:95%"></div>
          </div>
          <div class="chart-notes">
            Click on a bar to select a subject. Mouse scroll to zoom.
          </div>
        </div>
      </div>


    </div>

    <div class="row">
      <div class="col-sm-6">
        <div class="chart-wrapper">
          <div class="chart-title">
            Individual vs template T1 scan for subject
            <select class="select-subject" style="width: 50%">
              <option value="1">X0010001</option>
              <option value="2">X0010002</option>
            </select>
          </div>
          <div class="chart-stage">
            <div id="T1-indVsTemplate" class="register">
              <div class="slider-Wrapper">
                <a class="slider-Prev"></a>
                <a class="slider-Next"></a>
              </div>
            </div>
          </div>
          <div class="chart-notes">
            Hover the mouse over to switch between images.
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="chart-wrapper">
          <div class="chart-title">
            BOLD vs T1 scan for subject  
            <select id="select-BOLD" class="select-subject" style="width: 50%">
              <option value="1">X0010001</option>
              <option value="2">X0010002</option>
            </select>
          </div>
          <div class="chart-stage">
            <div class="chart-stage">
            <div id="boldVsT1" class="register">
              <div class="slider-Wrapper">
                <a class="slider-Prev"></a>
                <a class="slider-Next"></a>
              </div>
            </div>
        </div>
          <div class="chart-notes">
            Hover the mouse over to switch between images.
          </div>
        </div>
      </div>

    </div>

    <hr>

    <p class="small text-muted">Built with &#9829; by <a href="http://niak.simexp-lab.org">NIAK</a> using dashboards from <a href="https://keen.io">Keen IO</a></p>

  </div>

  <!--Dependencies-->
  <script src="assets/d3js/d3.min.js" charset="utf-8"></script>
  <script src="assets/c3js/c3.min.js"></script></head>
  <script type="text/javascript" src="assets/jquery/jquery.min.js"></script>       <!--from keen.io-->
  <script type="text/javascript" src="assets/bootstrap/bootstrap.min.js"></script> <!--from keen.io-->
  <script type="text/javascript" src="assets/keen/keen.min.js"></script>           <!--from keen.io-->
  <script type="text/javascript" src="assets/keen/meta.js"></script>               <!--from keen.io-->
  <script type="text/javascript" src="assets/underscore/underscore-min.js"></script>   <!--from pretty-json-->
  <script type="text/javascript" src="assets/backbone/backbone-min.js"></script>       <!--from pretty-json-->
  <script type="text/javascript" src="assets/pretty-json/pretty-json-min.js"></script> <!--from pretty-json-->
  <script src="assets/select2/select2.min.js"></script> <!--from select 2-->
  
  <!--Custom script to add a subject selection-->
  <script>
  $(document).ready(function() {
  
    var chart = c3.generate({
    bindto: '#chart-T1',
        data: {
        x: 'Subject',
        columns: [
            ['Subject','X0010001', 'X0010002'],
            ['corr_target',0.67,0.82]
        ],
        type: 'bar',
        onclick: function (d) { selectSubject(d,'chart-T1')}
    },
    axis: {
        x: {
            type: 'category',
            }
        },
    zoom: {
        enabled: true
    },
    selection: {
        enabled: true
    }
  });
  $('#chart-T1').data('c3-chart', chart);
  
  var chart2 = c3.generate({
    bindto: '#chart-BOLD',
        data: {
        columns: [
            ['corr_target',0.53,0.62]
        ],
        type: 'bar',
        onclick: function (d) { selectSubject(d,'chart-BOLD')}
    },
    axis: {
        x: {
            type: 'category',
            categories: ['X0010002', 'X0010001']
            }
        },
    zoom: {
        enabled: true
    },
    selection: {
        enabled: true
    }
  });
  $('#chart-BOLD').data('c3-chart', chart2);
  
  $(".select-subject").select2();  
    
  var $eventSelect = $(".select-subject");
  
  $eventSelect.on("select2:select", function (e) { setImg(e); })
  
  function setImg (evt) {
    var id = evt.params.data.id;
    subject = $("#select-BOLD option[value=" + id + "]").text();
    $es = $(".select-subject");
    $es.val(id);
    $es.trigger('change');
    var figBOLD = document.getElementById("boldVsT1"); 
    var newFigBOLD = document.createElement("img");
    var figT1 = document.getElementById("T1-indVsTemplate"); 
    var newFigT1 = document.createElement("img");
    newFigBOLD.src = "summary_" + subject + "_func.jpg";
    newFigBOLD.setAttribute("width", "100%");
    newFigT1.src = "summary_" + subject + "_anat.jpg";
    newFigT1.setAttribute("width", "100%");
    figBOLD.replaceChild(newFigBOLD, figBOLD.childNodes[0]);
    figT1.replaceChild(newFigT1, figT1.childNodes[0]);
    figBOLD.style.backgroundImage='url(summary_' + subject + '_anat.jpg)';
    figBOLD.style.backgroundSize ="100%";
    figT1.style.backgroundImage='url(summary_template.jpg)';
    figT1.style.backgroundSize ="100%";
    }  
  
  function selectSubject (d,type) {
    charti = $('#' + type).data('c3-chart');
    subject = charti.internal.config.axis_x_categories[d.x];
    id = $("#select-BOLD > option:contains("+subject+")").index();
    id = parseInt(id)+1;
    evtSelect = {params:{data:{id:id.toString()}}};
    setImg (evtSelect);
    }
    
  function nextSubject () {
    $es = $(".select-subject");
    currId = $es.val();
    currId = parseInt(currId);
    if (currId < 2) {
      currId+=1;
    } else {
      currId = 1;
    }
    var evt = {params:{data:{id:currId.toString()}}};
    setImg (evt);
    }
    
  function prevSubject () {
    $es = $(".select-subject");
    currId = $es.val();
    currId = parseInt(currId);
    if (currId > 1) {
       currId-=1;
    } else {
       currId = 2;
    }
    var evt = {params:{data:{id:currId.toString()}}};
    setImg (evt);
    }
    
  window.onload = function() {
    document.getElementsByClassName("slider-Next")[0].onclick = function fun() {
        nextSubject();
      }
    document.getElementsByClassName("slider-Next")[1].onclick = function fun() {
        nextSubject();
      }
    document.getElementsByClassName("slider-Prev")[0].onclick = function fun() {
        prevSubject();
      }
    document.getElementsByClassName("slider-Prev")[1].onclick = function fun() {
        prevSubject();
      }
}
  
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }
  
  var subject = getParameterByName('id');
  if (!subject) {
    var subject = "X0010001";
    var id = "1";
    };
  
  var evt = {params:{data:{id:id}}};
  setImg (evt); 
  });
  
  </script>

</body>
</html>
